<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Akkervarken · Admin</title>
  <link rel="stylesheet" href="/static/admin.css">
</head>
<body>
  <nav class="top-nav">
    <a href="/admin">Overzicht</a>
    <a href="/admin/orders">Bestellingen</a>
    <a href="/admin/products">Producten</a>
  </nav>
  <div class="page">
    <header>
      <div class="brand">
        <img src="https://akkervarken.be/img/logo.svg" alt="Akkervarken logo" loading="lazy">
        <div>
          <h1>Bestellingen</h1>
          <div class="meta-line">Snelle opvolging van recente orders</div>
        </div>
      </div>
      <form class="filters" method="get" action="/admin/orders">
        <label for="status_filter">Status:</label>
        <select name="status_filter" id="status_filter" onchange="this.form.submit()">
          <option value="">Alle</option>
          {% for s in statuses %}
            <option value="{{ s.value }}" {% if status_filter and s == status_filter %}selected{% endif %}>{{ s.value.title() }}</option>
          {% endfor %}
        </select>
      </form>
    </header>

    <div class="orders">
      {% if orders %}
        {% for order in orders %}
          <article class="card">
            <div class="card-header">
              <div class="order-meta">
                <div class="order-id">Bestelling #{{ order.id }}</div>
                <div class="meta-line">
                  {{ order.created_at.strftime('%d/%m/%Y %H:%M') if order.created_at else '' }} · {{ order.batch_name }}
                </div>
                <div class="status-chip">{{ order.status.value }}</div>
              </div>
              <form class="status-form" method="post" action="/admin/orders/{{ order.id }}/status">
                <label for="status-{{ order.id }}">Status</label>
                <select id="status-{{ order.id }}" name="new_status">
                  {% for s in statuses %}
                    <option value="{{ s.value }}" {% if s == order.status %}selected{% endif %}>{{ s.value.title() }}</option>
                  {% endfor %}
                </select>
                <button type="submit">Opslaan</button>
              </form>
            </div>

            <div class="meta-grid">
              <div class="meta-pill">
                <strong>{{ order.customer_name }}</strong><br>
                {{ order.customer_email or "Geen e-mail" }}<br>
                {{ order.customer_phone or "Geen telefoon" }}
              </div>
              <div class="meta-pill">
                Afhaling: {{ order.pickup_info or "Nog te bepalen" }}<br>
                Totaal: €{{ "%.2f"|format(order.total_amount) }}<br>
                Items: {{ order.total_items }}
              </div>
            </div>

            <div class="items">
              {% for item in order.items %}
                <div class="item-row">
                  <div class="item-name">{{ item.quantity }} × {{ item.product_name }}</div>
                  <div>€{{ "%.2f"|format(item.subtotal) }}</div>
                </div>
              {% endfor %}
            </div>

            {% if order.notes %}
              <div class="notes">Notities: {{ order.notes }}</div>
            {% endif %}
          </article>
        {% endfor %}
      {% else %}
        <div class="notice notice--warning">Geen bestellingen gevonden.</div>
      {% endif %}
    </div>
  </div>
</body>
</html>
