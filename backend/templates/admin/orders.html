<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bestellingen · Akkervarken Admin</title>
  <link rel="stylesheet" href="/static/admin.css">
</head>
<body>
  <nav class="top-nav">
    <a href="/admin">Overzicht</a>
    <a href="/admin/orders" class="active">Bestellingen</a>
    <a href="/admin/products">Producten</a>
  </nav>
  <div class="page">
    <header>
      <div>
        <h1>Bestellingen</h1>
        <div class="meta">{{ orders|length }} order{% if orders|length != 1 %}s{% endif %}</div>
      </div>
      <form class="filters" method="get" action="/admin/orders">
        <label for="status_filter">Status:</label>
        <select name="status_filter" id="status_filter" onchange="this.form.submit()">
          <option value="">Alle</option>
          {% for s in statuses %}
            <option value="{{ s.value }}" {% if status_filter and s == status_filter %}selected{% endif %}>{{ s.value.title() }}</option>
          {% endfor %}
        </select>
      </form>
    </header>

    {% if orders %}
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Klant</th>
            <th>Datum</th>
            <th>Batch</th>
            <th>Items</th>
            <th>Totaal</th>
            <th>Status</th>
            <th>Afhaling</th>
          </tr>
        </thead>
        <tbody>
          {% for order in orders %}
            <tr>
              <td><strong>#{{ order.id }}</strong></td>
              <td>
                <strong>{{ order.customer_name }}</strong><br>
                <span style="color: #777; font-size: 12px;">
                  {{ order.customer_email or "—" }}<br>
                  {{ order.customer_phone or "—" }}
                </span>
              </td>
              <td style="white-space: nowrap;">{{ order.created_at.strftime('%d/%m/%Y %H:%M') if order.created_at else '—' }}</td>
              <td>{{ order.batch_name }}</td>
              <td>
                <ul class="items-list">
                  {% for item in order.items %}
                    <li>{{ item.quantity }}× {{ item.product_name }} <span style="color: #999;">(€{{ "%.2f"|format(item.computed_subtotal) }})</span></li>
                  {% endfor %}
                </ul>
                {% if order.notes %}
                  <div style="margin-top: 6px; padding: 4px 6px; background: #ffc; border: 1px solid #ee9; font-size: 12px;">{{ order.notes }}</div>
                {% endif %}
              </td>
              <td style="white-space: nowrap;"><strong>€{{ "%.2f"|format(order.total_amount) }}</strong></td>
              <td>
                <form class="status-form" method="post" action="/admin/orders/{{ order.id }}/status">
                  <label for="status-{{ order.id }}">Status</label>
                  <select id="status-{{ order.id }}" name="new_status">
                    {% for s in statuses %}
                      <option value="{{ s.value }}" {% if s == order.status %}selected{% endif %}>{{ s.value.title() }}</option>
                    {% endfor %}
                  </select>
                  <button type="submit" class="btn">OK</button>
                </form>
              </td>
              <td style="font-size: 12px;">{{ order.pickup_info or "—" }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="notice notice--warning">Geen bestellingen gevonden.</div>
    {% endif %}
  </div>
</body>
</html>
