{{ define "main" }}
{{ .Content }}

<div class="batches">
        {{ range $index, $batch := .Site.Data.batches.batches }}
        <div class="batch {{ if eq $index 0 }}open{{ else }}closed{{ end }}">
            <div class="batch-header" onclick="toggleBatch(this)">
                <h3>{{ .name }}</h3>
                <span class="toggle-icon">{{ if eq $index 0 }}âˆ’{{ else }}+{{ end }}</span>
            </div>
            <div class="batch-content">
                <div class="batch-info">
                    <p><strong>Slachtdatum:</strong> {{ index . "slaughter-date" }}</p>
                    <p><strong>Bestellen tot:</strong> {{ index . "order-deadline" }}</p>
                    <p><strong>Ophalen tussen:</strong> {{ index . "pickup-date-start" }} en {{ index . "pickup-date-end" }}</p>
                    <p><strong>Ophaallocatie:</strong> {{ index . "pickup-location" }}</p>
                </div>

                <div class="products">
                    {{ range index . "available-products" }}
                    {{ $productId := index . "product-id" }}
                    {{ $stock := .stock }}
                    {{ $batchId := $batch.id }}
                    {{ range $.Site.Data.products.products }}
                    {{ if eq .id $productId }}
                    <div class="product" data-id="{{ $batchId }}-{{ .id }}" data-name="{{ .name }}" data-price="{{ .price }}" data-weight="{{ .weight }}" data-pickup-start="{{ index $batch "pickup-date-start" }}" data-pickup-end="{{ index $batch "pickup-date-end" }}" data-batch="{{ $batch.name }}">
                        {{ if .image }}
                        <div class="product-image">
                            <img src="{{ .image | relURL }}" alt="{{ .name }}" loading="lazy">
                        </div>
                        {{ end }}
                        <h4>{{ .name }}</h4>
                        <p class="description">{{ .description | markdownify }}</p>
                        <div class="product-details">
                            <span class="price">{{ .price }}</span>
                            <span class="weight">{{ .weight }}</span>
                        </div>
                        <div class="stock">
                            <small>Nog {{ $stock }} beschikbaar</small>
                        </div>
                        <div class="quantity-controls">
                            <button type="button" onclick="decreaseQuantity('{{ $batchId }}-{{ .id }}')">-</button>
                            <input type="number" id="qty-{{ $batchId }}-{{ .id }}" value="0" min="0" max="{{ $stock }}" onchange="updateQuantity('{{ $batchId }}-{{ .id }}', this.value)">
                            <button type="button" onclick="increaseQuantity('{{ $batchId }}-{{ .id }}')">+</button>
                        </div>
                    </div>
                    {{ end }}
                    {{ end }}
                    {{ end }}
                </div>
            </div>
        </div>
        {{ end }}
    </div>

    <section class="order-summary">
        <h3>Bestelling</h3>
        <div id="order-items"></div>
        <div id="order-total"></div>
        <button id="send-order" onclick="sendOrder()" style="display: none;">Bestelling versturen via e-mail</button>
    </section>

{{- $js := resources.Get "js/webshop.js" | minify | fingerprint -}}
<script src="{{ $js.RelPermalink }}" integrity="{{ $js.Data.Integrity }}" defer></script>
{{ end }}
