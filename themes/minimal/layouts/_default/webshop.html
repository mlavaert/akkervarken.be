{{ define "main" }}
{{ .Content }}

<div class="batches">
        {{ range $index, $batch := .Site.Data.batches.batches }}
        <div class="batch {{ if eq $index 0 }}open{{ else }}closed{{ end }}">
            <div class="batch-header" onclick="toggleBatch(this)">
                <h3>{{ .name }}</h3>
                <span class="toggle-icon">{{ if eq $index 0 }}‚àí{{ else }}+{{ end }}</span>
            </div>
            <div class="batch-content">
                <div class="batch-info">
                    <div class="batch-info-primary">
                        <div class="info-item">
                            <span class="info-label">üì¶ Ophalen</span>
                            <span class="info-value">{{ index . "pickup-date-start" }} - {{ index . "pickup-date-end" }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">üìç Locatie</span>
                            <span class="info-value">{{ index . "pickup-location" }}</span>
                        </div>
                    </div>
                    <div class="batch-info-secondary">
                        <small>Bestellen tot {{ index . "order-deadline" }}</small>
                    </div>
                </div>

                <div class="products">
                    {{ range index . "available-products" }}
                    {{ $productId := index . "product-id" }}
                    {{ $stock := .stock }}
                    {{ $batchId := $batch.id }}
                    {{ range $.Site.Data.products.products }}
                    {{ if eq .id $productId }}
                    {{ $productName := .name }}
                    {{ $productImage := .image }}
                    <div class="product" data-id="{{ $batchId }}-{{ .id }}" data-name="{{ .name }}" data-price="{{ .price }}" data-weight="{{ .weight }}" data-pickup-start="{{ index $batch "pickup-date-start" }}" data-pickup-end="{{ index $batch "pickup-date-end" }}" data-batch="{{ $batch.name }}">
                        {{ if and $productImage (ne (trim $productImage " ") "") }}
                        <div class="product-image">
                            <img src="{{ $productImage | relURL }}" alt="{{ $productName }}" loading="lazy">
                        </div>
                        {{ end }}
                        <h4>{{ .name }}</h4>
                        <p class="description">{{ .description | markdownify }}</p>
                        <div class="product-details">
                            <span class="price">‚Ç¨{{ printf "%.2f" .price | replaceRE "\\." "," }}</span>
                            <span class="weight">{{ .weight }}</span>
                        </div>
                        <div class="stock">
                            <small>Nog {{ $stock }} beschikbaar</small>
                        </div>
                        <div class="quantity-controls">
                            <button type="button" class="qty-btn qty-decrease" onclick="decreaseQuantity('{{ $batchId }}-{{ .id }}')">‚àí</button>
                            <div class="qty-display">
                                <span id="qty-display-{{ $batchId }}-{{ .id }}" class="qty-number">0</span>
                                <input type="hidden" id="qty-{{ $batchId }}-{{ .id }}" value="0" min="0" max="{{ $stock }}">
                            </div>
                            <button type="button" class="qty-btn qty-increase" onclick="increaseQuantity('{{ $batchId }}-{{ .id }}')">+</button>
                        </div>
                    </div>
                    {{ end }}
                    {{ end }}
                    {{ end }}
                </div>
            </div>
        </div>
        {{ end }}
    </div>

    <section class="order-summary">
        <h3>Bestelling</h3>
        <div id="order-items"></div>
        <div id="order-total"></div>
        <button id="send-order" onclick="sendOrder()" style="display: none;">Bestelling versturen via e-mail</button>
    </section>

{{- $js := resources.Get "js/webshop.js" -}}
{{- if $js -}}
    {{- $js = $js | minify | fingerprint -}}
    <script src="{{ $js.RelPermalink }}" integrity="{{ $js.Data.Integrity }}" defer></script>
{{- else -}}
    <script src="{{ "js/webshop.js" | relURL }}" defer></script>
{{- end -}}
{{ end }}
